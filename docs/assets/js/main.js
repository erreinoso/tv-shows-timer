"use strict";const input=document.querySelector(".js-input"),btn=document.querySelector(".js-button"),resultSectionP=document.querySelector(".js-resultSection-p"),favSectionDays=document.querySelector(".js-favSection-p .days"),favSectionHours=document.querySelector(".js-favSection-p .ours"),favSection=document.querySelector(".js-ul-fav"),btnReset=document.querySelector(".js-reset-all"),favouriteSection=document.querySelector(".js-favouriteSection"),resetElem=document.querySelectorAll(".js-delete"),imgTemporary="https://via.placeholder.com/210x295/ffffff/666666/",resultsWrapper=document.querySelector(".js-ul-result");let searchinput,seriesResult=[],favouriteSeries=[];function getSeriesId(){searchinput=input.value.replaceAll(" ","-"),fetch("https://www.episodate.com/api/show-details?q="+searchinput).then(e=>e.json()).then(e=>{seriesResult=e.tvShow,renderSearch(),addListeners()})}function renderSearch(){let e,t;resultsWrapper.innerHTML="";resultsWrapper.querySelectorAll("li");let r=seriesResult.episodes.length;1934===seriesResult.id?resultSectionP.classList.remove("hidden"):resultSectionP.classList.add("hidden"),t=void 0===seriesResult.image_path?imgTemporary:seriesResult.image_path,1934!==seriesResult.id&&void 0!==seriesResult.id&&(e=`<li class="js-serieCard serieCard" id="${seriesResult.id}">`,e+=`<div class="serieCard_img"><img src="${t}" alt="Foto de ${seriesResult.image_path}"></div>`,e+=`<div class="serieCard_data "><h3>${seriesResult.name}</h3>`,e+=`<h4>Episodes: ${r}</h4></div>`,e+="</li>",resultsWrapper.innerHTML+=e)}function favouritesHandler(e){e.currentTarget;addToFavouritesArray(e),renderFavouriteSection(e),renderFavouriteTime(e)}function addToFavouritesArray(e){const t=e.currentTarget,r=t.querySelector("h3").innerHTML;console.log("clickedCardName",r),console.log("seriesResult",seriesResult),console.log("favouriteSeries",favouriteSeries);const s=favouriteSeries.findIndex(e=>e.name===r);if(-1===s){const e=seriesResult;t.classList.add("favelement"),favouriteSeries.push(e)}else t.classList.remove("favelement"),favouriteSeries.splice(s,1);updateLocalStorage()}function renderFavouriteSection(){let e,t,r,s="";if(favSection.innerHTML="",0===favouriteSeries.length)btnReset.classList.add("hidden"),favouriteSection.classList.add("hidden");else{for(btnReset.classList.remove("hidden"),favouriteSection.classList.remove("hidden"),e=0;e<favouriteSeries.length;e++){let i=favouriteSeries[e].runtime*favouriteSeries[e].episodes.length/60,o=Math.ceil(i/24);t=null===favouriteSeries[e].image_path?imgTemporary:favouriteSeries[e].image_path,r=o<=1?"day":"days",s+=`<li class="js-serieFavCard serieFavCard" id="${favouriteSeries[e].id}">`,s+=`<div class="serieFavCard_img"><img src="${t}" alt="Foto de ${favouriteSeries[e].name}"></div>`,s+=`<div class="serieFavCard_data"><h3 >${favouriteSeries[e].name}</h3>`,s+=`<h4 class="hidden"> Duración del episodio: ${favouriteSeries[e].runtime} minutos</h4>`,s+=`<h4 class="hidden" > Número de episodios: ${favouriteSeries[e].episodes.length}</h4>`,s+=`<h4> Spent time: <br>${i} hours or almost ${o} ${r}  </h4>`,s+='<i  class=" icon icon-trash far fa-trash-alt js-delete resetButton" ></i><div>',favSection.innerHTML=s}listenResetBtn()}}function renderFavouriteTime(){const e=document.querySelector(".js-favSection-p .days"),t=document.querySelector(".js-favSection-p .hours"),r=document.querySelector(".js-favSection-notes .days-text");let s,i;e.innerHTML="00",t.innerHTML="00";let o,a,n,l=0,c=0;if(0!==favouriteSeries.length)for(let u=0;u<favouriteSeries.length;u++)i=favouriteSeries[u].runtime*favouriteSeries[u].episodes.length/60,o=favouriteSeries[u].runtime*favouriteSeries[u].episodes.length/1440,l+=i,c+=o,a=parseInt(c).toString().padStart(2,"0"),s=parseInt(l-24*a).toString().padStart(2,"0"),n=a<=1?"day":"days",e.innerHTML=a,t.innerHTML=s,r.innerHTML=n}const resetAll=()=>{localStorage.removeItem("watchedSeries"),favouriteSeries=[],updateLocalStorage(),renderFavouriteSection(ev);const e=document.querySelectorAll(".js-serieCard");for(const t of e)t.classList.remove("favelement")},resetOneFav=e=>{const t=parseInt(e.currentTarget.parentElement.parentElement.id),r=favouriteSeries.findIndex(e=>e.id===t),s=e.currentTarget.parentNode.parentNode.id;favouriteSeries.splice(r,1),updateLocalStorage(),renderFavouriteSection(e);const i=resultsWrapper.querySelectorAll("li");for(const e of i)e.id===s&&e.classList.remove("favelement");renderFavouriteSection(e),renderFavouriteTime(e)};function updateLocalStorage(){localStorage.setItem("favouriteSeries",JSON.stringify(favouriteSeries))}const getFromLocalStorage=()=>{const e=JSON.parse(localStorage.getItem("favouriteSeries"));null!==e&&(favouriteSeries=e),renderFavouriteSection()};function addListeners(){let e=document.querySelectorAll(".js-serieCard");for(const t of e)t.addEventListener("click",favouritesHandler)}btn.addEventListener("click",getSeriesId),btnReset.addEventListener("click",resetAll);const listenResetBtn=()=>{const e=document.querySelectorAll(".js-delete");for(let t of e)t.addEventListener("click",resetOneFav)};getSeriesId(),getFromLocalStorage(),renderFavouriteTime();